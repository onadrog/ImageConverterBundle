(()=>{var e=document.querySelector("input[data-name='image_converter']"),t=(document.querySelector("input[data-name='alt']"),new FileReader),a=(new FormData,document.createElement("canvas")),n=(a.getContext("2d"),new Image),i=document.createElement("canvas"),r=i.getContext("2d"),o=new Image,d=document.createElement("input");e.addEventListener("change",(function(l){var m=document.querySelector("form"),c=document.getElementById(m.name),s=l.target,g=s.files[0],u=g.name,h=parseInt(e.dataset.qual,10)/100;n.height=200,t.onload=function(e){n.src=e.target.result},n.onload=function(){a.width=n.width,a.height=n.height},t.readAsDataURL(g),s.parentElement.append(n);var f=URL.createObjectURL(g);o.src=f,o.onload=function(){console.log(o.height),URL.revokeObjectURL(f),i.width=o.width,i.height=o.height,r.drawImage(o,0,0),d.type="file",d.name=m.name+"["+e.dataset.prop+"][original_file]",d.style.display="none";var t=new DataTransfer;t.items.add(g),d.files=t.files,c.append(d),i.toBlob((function(t){var a=new File([t],u,{type:"image/webp",lastModified:(new Date).getTime()}),n=new DataTransfer;n.items.add(a),e.files=n.files}),"image/webp",h)}}))})();